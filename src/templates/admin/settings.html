{% extends "base.html" %}

{% block title %}Settings - StaffSync{% endblock %}

{% block content %}
<!-- Mobile Menu Toggle -->
<button class="mobile-menu-toggle" onclick="toggleSidebar()" aria-label="Toggle Menu">
    <i class="fas fa-bars"></i>
</button>

<!-- Sidebar -->
<div class="sidebar" id="sidebar">
    <div class="sidebar-header">
        <h3><i class="fas fa-users"></i> StaffSync</h3>
        <p>Admin Panel</p>
    </div>
    <nav class="sidebar-nav">
        <a href="{{ url_for('admin_dashboard') }}">
            <i class="fas fa-tachometer-alt"></i> Dashboard
        </a>
        <a href="{{ url_for('admin_employees') }}">
            <i class="fas fa-users"></i> Employees
        </a>
        <a href="{{ url_for('admin_attendance') }}">
            <i class="fas fa-clock"></i> Attendance
        </a>
        <a href="{{ url_for('admin_payroll') }}">
            <i class="fas fa-money-bill-wave"></i> Payroll
        </a>
        <a href="{{ url_for('admin_departments') }}">
            <i class="fas fa-building"></i> Departments
        </a>
        <a href="{{ url_for('admin_settings') }}" class="active">
            <i class="fas fa-cog"></i> Settings
        </a>
        <hr>
        <a href="{{ url_for('logout') }}">
            <i class="fas fa-sign-out-alt"></i> Logout
        </a>
    </nav>
</div>

<!-- Main Content -->
<div class="main-content">
    <!-- Page Header -->
    <div class="page-header">
        <div>
            <h1><i class="fas fa-cog"></i> System Settings</h1>
            <p class="text-muted">Configure and manage your StaffSync system</p>
        </div>
    </div>
    
    <!-- Settings Sections -->
    <div class="settings-container">
        <!-- Company Settings -->
        <div class="settings-section">
            <div class="section-header">
                <h2><i class="fas fa-building"></i> Company Information</h2>
                <p class="text-muted">Manage your company details and branding</p>
            </div>
            
            <form class="settings-form" method="POST" action="{{ url_for('update_company_settings') }}">
                <div class="form-row">
                    <div class="form-group">
                        <label for="company_name">Company Name</label>
                        <input type="text" id="company_name" name="company_name" value="{{ settings.company_name or 'StaffSync Corp' }}">
                    </div>
                    
                    <div class="form-group">
                        <label for="company_email">Company Email</label>
                        <input type="email" id="company_email" name="company_email" value="{{ settings.company_email or 'admin@staffsync.com' }}">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="company_phone">Phone Number</label>
                        <input type="tel" id="company_phone" name="company_phone" value="{{ settings.company_phone or '+1 (555) 123-4567' }}">
                    </div>
                    
                    <div class="form-group">
                        <label for="company_website">Website</label>
                        <input type="url" id="company_website" name="company_website" value="{{ settings.company_website or 'https://staffsync.com' }}">
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="company_address">Address</label>
                    <textarea id="company_address" name="company_address" rows="3">{{ settings.company_address or '123 Business Street, Suite 100\nCity, State 12345\nCountry' }}</textarea>
                </div>
                
                <div class="form-actions">
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save"></i> Save Company Info
                    </button>
                </div>
            </form>
        </div>
        
        <!-- System Settings -->
        <div class="settings-section">
            <div class="section-header">
                <h2><i class="fas fa-server"></i> System Configuration</h2>
                <p class="text-muted">Configure system behavior and preferences</p>
            </div>
            
            <form class="settings-form" method="POST" action="{{ url_for('update_system_settings') }}">
                <div class="form-row">
                    <div class="form-group">
                        <label for="timezone">System Timezone</label>
                        <select id="timezone" name="timezone">
                            <option value="UTC" {{ 'selected' if settings.timezone == 'UTC' }}>UTC</option>
                            <option value="America/New_York" {{ 'selected' if settings.timezone == 'America/New_York' }}>Eastern Time</option>
                            <option value="America/Chicago" {{ 'selected' if settings.timezone == 'America/Chicago' }}>Central Time</option>
                            <option value="America/Denver" {{ 'selected' if settings.timezone == 'America/Denver' }}>Mountain Time</option>
                            <option value="America/Los_Angeles" {{ 'selected' if settings.timezone == 'America/Los_Angeles' }}>Pacific Time</option>
                            <option value="Europe/London" {{ 'selected' if settings.timezone == 'Europe/London' }}>London</option>
                            <option value="Europe/Paris" {{ 'selected' if settings.timezone == 'Europe/Paris' }}>Paris</option>
                            <option value="Asia/Tokyo" {{ 'selected' if settings.timezone == 'Asia/Tokyo' }}>Tokyo</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="date_format">Date Format</label>
                        <select id="date_format" name="date_format">
                            <option value="MM/DD/YYYY" {{ 'selected' if settings.date_format == 'MM/DD/YYYY' }}>MM/DD/YYYY</option>
                            <option value="DD/MM/YYYY" {{ 'selected' if settings.date_format == 'DD/MM/YYYY' }}>DD/MM/YYYY</option>
                            <option value="YYYY-MM-DD" {{ 'selected' if settings.date_format == 'YYYY-MM-DD' }}>YYYY-MM-DD</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="currency">Currency</label>
                        <select id="currency" name="currency">
                            <option value="USD" {{ 'selected' if settings.currency == 'USD' }}>USD - US Dollar</option>
                            <option value="EUR" {{ 'selected' if settings.currency == 'EUR' }}>EUR - Euro</option>
                            <option value="GBP" {{ 'selected' if settings.currency == 'GBP' }}>GBP - British Pound</option>
                            <option value="JPY" {{ 'selected' if settings.currency == 'JPY' }}>JPY - Japanese Yen</option>
                            <option value="CAD" {{ 'selected' if settings.currency == 'CAD' }}>CAD - Canadian Dollar</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="working_hours">Default Working Hours</label>
                        <input type="number" id="working_hours" name="working_hours" min="1" max="24" value="{{ settings.working_hours or 8 }}">
                    </div>
                </div>
                
                <div class="form-group">
                    <div class="checkbox-group">
                        <label class="checkbox-label">
                            <input type="checkbox" name="email_notifications" {{ 'checked' if settings.email_notifications }}>
                            <span class="checkmark"></span>
                            Enable Email Notifications
                        </label>
                        
                        <label class="checkbox-label">
                            <input type="checkbox" name="auto_backup" {{ 'checked' if settings.auto_backup }}>
                            <span class="checkmark"></span>
                            Enable Automatic Backups
                        </label>
                        
                        <label class="checkbox-label">
                            <input type="checkbox" name="two_factor_auth" {{ 'checked' if settings.two_factor_auth }}>
                            <span class="checkmark"></span>
                            Require Two-Factor Authentication
                        </label>
                    </div>
                </div>
                
                <div class="form-actions">
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save"></i> Save System Settings
                    </button>
                </div>
            </form>
        </div>
        
        <!-- Security Settings -->
        <div class="settings-section">
            <div class="section-header">
                <h2><i class="fas fa-shield-alt"></i> Security & Privacy</h2>
                <p class="text-muted">Manage security policies and data protection</p>
            </div>
            
            <div class="security-options">
                <div class="security-item">
                    <div class="security-info">
                        <h3>Password Policy</h3>
                        <p class="text-muted">Configure password requirements for all users</p>
                    </div>
                    <button class="btn btn-outline" onclick="openPasswordPolicyModal()">
                        <i class="fas fa-cog"></i> Configure
                    </button>
                </div>
                
                <div class="security-item">
                    <div class="security-info">
                        <h3>Session Management</h3>
                        <p class="text-muted">Control user session timeout and security</p>
                    </div>
                    <button class="btn btn-outline" onclick="openSessionModal()">
                        <i class="fas fa-cog"></i> Configure
                    </button>
                </div>
                
                <div class="security-item">
                    <div class="security-info">
                        <h3>Data Backup</h3>
                        <p class="text-muted">Manage system backups and data recovery</p>
                    </div>
                    <button class="btn btn-outline" onclick="initiateBackup()">
                        <i class="fas fa-download"></i> Create Backup
                    </button>
                </div>
                
                <div class="security-item">
                    <div class="security-info">
                        <h3>Audit Logs</h3>
                        <p class="text-muted">View system activity and security logs</p>
                    </div>
                    <button class="btn btn-outline" onclick="viewAuditLogs()">
                        <i class="fas fa-list"></i> View Logs
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Integration Settings -->
        <div class="settings-section">
            <div class="section-header">
                <h2><i class="fas fa-plug"></i> Integrations</h2>
                <p class="text-muted">Connect with third-party services and APIs</p>
            </div>
            
            <div class="integrations-grid">
                <div class="integration-card">
                    <div class="integration-icon">
                        <i class="fab fa-slack"></i>
                    </div>
                    <div class="integration-info">
                        <h4>Slack Integration</h4>
                        <p class="text-muted">Send notifications to Slack channels</p>
                        <span class="status-badge status-inactive">Not Connected</span>
                    </div>
                    <button class="btn btn-primary btn-sm">Connect</button>
                </div>
                
                <div class="integration-card">
                    <div class="integration-icon">
                        <i class="fas fa-envelope"></i>
                    </div>
                    <div class="integration-info">
                        <h4>Email Service</h4>
                        <p class="text-muted">Configure SMTP for email notifications</p>
                        <span class="status-badge status-active">Connected</span>
                    </div>
                    <button class="btn btn-outline btn-sm">Configure</button>
                </div>
                
                <div class="integration-card">
                    <div class="integration-icon">
                        <i class="fab fa-google"></i>
                    </div>
                    <div class="integration-info">
                        <h4>Google Workspace</h4>
                        <p class="text-muted">Sync with Google Calendar and Drive</p>
                        <span class="status-badge status-inactive">Not Connected</span>
                    </div>
                    <button class="btn btn-primary btn-sm">Connect</button>
                </div>
                
                <div class="integration-card">
                    <div class="integration-icon">
                        <i class="fab fa-microsoft"></i>
                    </div>
                    <div class="integration-info">
                        <h4>Microsoft 365</h4>
                        <p class="text-muted">Integrate with Office 365 services</p>
                        <span class="status-badge status-inactive">Not Connected</span>
                    </div>
                    <button class="btn btn-primary btn-sm">Connect</button>
                </div>
            </div>
        </div>
        
        <!-- System Information -->
        <div class="settings-section">
            <div class="section-header">
                <h2><i class="fas fa-info-circle"></i> System Information</h2>
                <p class="text-muted">View system status and version details</p>
            </div>
            
            <div class="system-info">
                <div class="info-grid">
                    <div class="info-item">
                        <label>Application Version</label>
                        <span>StaffSync v2.1.0</span>
                    </div>
                    
                    <div class="info-item">
                        <label>Database Version</label>
                        <span>SQLite 3.45.1</span>
                    </div>
                    
                    <div class="info-item">
                        <label>Python Version</label>
                        <span>3.12.1</span>
                    </div>
                    
                    <div class="info-item">
                        <label>Flask Version</label>
                        <span>3.1.2</span>
                    </div>
                    
                    <div class="info-item">
                        <label>System Uptime</label>
                        <span id="uptime">Loading...</span>
                    </div>
                    
                    <div class="info-item">
                        <label>Last Backup</label>
                        <span>{{ last_backup or 'Never' }}</span>
                    </div>
                </div>
                
                <div class="system-actions">
                    <button class="btn btn-outline" onclick="checkForUpdates()">
                        <i class="fas fa-sync"></i> Check for Updates
                    </button>
                    <button class="btn btn-outline" onclick="restartSystem()">
                        <i class="fas fa-power-off"></i> Restart System
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.page-header {
    margin-bottom: 2rem;
}

.settings-container {
    display: flex;
    flex-direction: column;
    gap: 2rem;
}

.settings-section {
    background: white;
    border-radius: var(--border-radius);
    box-shadow: var(--shadow-sm);
    overflow: hidden;
}

.section-header {
    background: linear-gradient(135deg, var(--primary-color), var(--accent-color));
    color: white;
    padding: 2rem;
    text-align: center;
}

.section-header h2 {
    margin: 0 0 0.5rem 0;
    font-size: 1.5rem;
    font-weight: 600;
}

.section-header p {
    margin: 0;
    opacity: 0.9;
}

.settings-form {
    padding: 2rem;
}

.form-row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 1.5rem;
    margin-bottom: 1rem;
}

.form-group {
    margin-bottom: 1rem;
}

.form-group label {
    display: block;
    font-weight: 600;
    color: var(--text-dark);
    margin-bottom: 0.5rem;
}

.form-group input,
.form-group select,
.form-group textarea {
    width: 100%;
    padding: 0.75rem;
    border: 1px solid var(--border-color);
    border-radius: var(--border-radius);
    font-size: 1rem;
}

.form-group input:focus,
.form-group select:focus,
.form-group textarea:focus {
    outline: none;
    border-color: var(--primary-color);
    box-shadow: 0 0 0 3px rgba(74, 144, 226, 0.1);
}

.checkbox-group {
    display: flex;
    flex-direction: column;
    gap: 1rem;
}

.checkbox-label {
    display: flex;
    align-items: center;
    cursor: pointer;
    font-weight: 500;
}

.checkbox-label input[type="checkbox"] {
    width: auto;
    margin-right: 0.75rem;
}

.form-actions {
    margin-top: 2rem;
    padding-top: 2rem;
    border-top: 1px solid var(--border-color);
}

.security-options {
    padding: 2rem;
}

.security-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1.5rem;
    border: 1px solid var(--border-color);
    border-radius: var(--border-radius);
    margin-bottom: 1rem;
}

.security-item:last-child {
    margin-bottom: 0;
}

.security-info h3 {
    margin: 0 0 0.25rem 0;
    color: var(--text-dark);
}

.integrations-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 1.5rem;
    padding: 2rem;
}

.integration-card {
    display: flex;
    align-items: center;
    gap: 1rem;
    padding: 1.5rem;
    border: 1px solid var(--border-color);
    border-radius: var(--border-radius);
    transition: box-shadow 0.2s ease;
}

.integration-card:hover {
    box-shadow: var(--shadow-md);
}

.integration-icon {
    width: 50px;
    height: 50px;
    border-radius: 50%;
    background: #f8f9fa;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.5rem;
    color: var(--primary-color);
}

.integration-info {
    flex: 1;
}

.integration-info h4 {
    margin: 0 0 0.25rem 0;
    color: var(--text-dark);
}

.integration-info p {
    margin: 0 0 0.5rem 0;
    font-size: 0.875rem;
}

.status-badge {
    padding: 0.25rem 0.5rem;
    border-radius: 1rem;
    font-size: 0.75rem;
    font-weight: 600;
    text-transform: uppercase;
}

.status-active {
    background: #d4edda;
    color: #155724;
}

.status-inactive {
    background: #f8d7da;
    color: #721c24;
}

.system-info {
    padding: 2rem;
}

.info-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1.5rem;
    margin-bottom: 2rem;
}

.info-item {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
}

.info-item label {
    font-weight: 600;
    color: var(--text-light);
    font-size: 0.875rem;
}

.info-item span {
    font-weight: 500;
    color: var(--text-dark);
}

.system-actions {
    display: flex;
    gap: 1rem;
    justify-content: center;
    padding-top: 2rem;
    border-top: 1px solid var(--border-color);
}

@media (max-width: 768px) {
    .form-row {
        grid-template-columns: 1fr;
    }
    
    .integrations-grid {
        grid-template-columns: 1fr;
    }
    
    .security-item {
        flex-direction: column;
        gap: 1rem;
        text-align: center;
    }
    
    .system-actions {
        flex-direction: column;
    }
}
</style>
{% endblock %}

{% block extra_js %}
<script>
// Settings management functions
function openPasswordPolicyModal() {
    showNotification('Password policy configuration - Coming soon!', 'info');
}

function openSessionModal() {
    showNotification('Session management configuration - Coming soon!', 'info');
}

function initiateBackup() {
    if (confirm('This will create a backup of your system data. Continue?')) {
        showNotification('Backup initiated successfully!', 'success');
    }
}

function viewAuditLogs() {
    showNotification('Audit logs viewer - Coming soon!', 'info');
}

function checkForUpdates() {
    showNotification('Checking for updates...', 'info');
    setTimeout(() => {
        showNotification('System is up to date!', 'success');
    }, 2000);
}

function restartSystem() {
    if (confirm('Are you sure you want to restart the system? All users will be logged out.')) {
        showNotification('System restart initiated...', 'warning');
    }
}

// Update uptime display
function updateUptime() {
    // This would normally get real uptime from server
    const startTime = new Date('2025-10-31T18:00:00');
    const now = new Date();
    const diff = now - startTime;
    
    const days = Math.floor(diff / (1000 * 60 * 60 * 24));
    const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
    const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
    
    document.getElementById('uptime').textContent = `${days}d ${hours}h ${minutes}m`;
}

// Update uptime every minute
setInterval(updateUptime, 60000);
updateUptime();

// Form submission handlers
document.addEventListener('DOMContentLoaded', function() {
    const forms = document.querySelectorAll('.settings-form');
    forms.forEach(form => {
        form.addEventListener('submit', function(e) {
            e.preventDefault();
            showNotification('Settings saved successfully!', 'success');
        });
    });
});
</script>
{% endblock %}